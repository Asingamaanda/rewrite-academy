{% extends "base.html" %}
{% block title %}Assessments ‚Äî Rewrite Academy{% endblock %}

{% block extra_css %}
<style>
.stat-row{display:grid;grid-template-columns:repeat(4,1fr);gap:1rem;margin-bottom:1.75rem;}
@media(max-width:900px){.stat-row{grid-template-columns:repeat(2,1fr);}}
.stat-tile{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.25rem 1.5rem;text-align:center;}
.stat-tile .val{font-size:1.75rem;font-weight:700;font-family:'Playfair Display',serif;}
.stat-tile .lbl{font-size:0.75rem;color:var(--text-muted);margin-top:4px;text-transform:uppercase;letter-spacing:0.06em;}
.filter-bar{display:flex;gap:0.75rem;align-items:center;flex-wrap:wrap;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);padding:1rem 1.25rem;margin-bottom:1.75rem;}
.section-panel{background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);padding:1.5rem;margin-top:1.75rem;}
.panel-title{font-size:0.72rem;font-weight:700;text-transform:uppercase;letter-spacing:0.1em;color:var(--accent);margin-bottom:1.25rem;padding-bottom:0.65rem;border-bottom:1px solid var(--border);}
.form-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:1rem;}
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <div class="flex-between">
        <div>
            <h1>üìã Assessments</h1>
            <p>Record and review student performance</p>
        </div>
    </div>
</div>

<div class="stat-row">
    <div class="stat-tile">
        <div class="val" style="color:var(--accent);">{{ class_summary.class_average }}%</div>
        <div class="lbl">Class Average</div>
    </div>
    <div class="stat-tile">
        <div class="val" style="color:#34d399;">{{ class_summary.risk_breakdown.get('low', 0) }}</div>
        <div class="lbl">On Track</div>
    </div>
    <div class="stat-tile">
        <div class="val" style="color:#fbbf24;">{{ class_summary.risk_breakdown.get('medium', 0) }}</div>
        <div class="lbl">Medium Risk</div>
    </div>
    <div class="stat-tile">
        <div class="val" style="color:#fca5a5;">{{ class_summary.risk_breakdown.get('high', 0) }}</div>
        <div class="lbl">High Risk</div>
    </div>
</div>

<form method="GET" action="/assessments">
    <div class="filter-bar">
        <label style="margin-bottom:0;white-space:nowrap;">Subject</label>
        <select name="subject" style="width:auto;min-width:200px;">
            <option value="">All Subjects</option>
            {% for subject in subjects %}
            <option value="{{ subject }}" {% if subject_filter == subject %}selected{% endif %}>{{ subject }}</option>
            {% endfor %}
        </select>
        <button type="submit" class="btn-cinematic">Filter</button>
        <a href="/assessments" class="btn-outline">Clear</a>
    </div>
</form>

{% if assessments %}
<div style="background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);overflow:hidden;">
    <table class="data-table">
        <thead>
            <tr>
                <th>Date</th><th>Student</th><th>Subject</th><th>Type</th><th>Score</th><th>%</th><th></th>
            </tr>
        </thead>
        <tbody>
            {% for a in assessments %}
            <tr>
                <td>{{ a.date }}</td>
                <td>
                    <span style="color:var(--accent);font-weight:700;font-size:0.8rem;">{{ a.student_id }}</span><br>
                    <span style="font-size:0.82rem;">{{ a.student_name }}</span>
                </td>
                <td>{{ a.subject }}</td>
                <td><span class="badge badge-cyan">{{ a.type }}</span></td>
                <td style="font-weight:600;">{{ a.score }} / {{ a.max_score }}</td>
                <td>
                    <span class="badge {% if a.percentage >= 70 %}badge-green{% elif a.percentage >= 50 %}badge-amber{% else %}badge-red{% endif %}">
                        {{ a.percentage }}%
                    </span>
                </td>
                <td><a href="/student/{{ a.student_id }}" class="btn-outline" style="padding:5px 12px;font-size:0.8rem;">View</a></td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div style="text-align:center;padding:3rem 2rem;background:var(--bg-elevated);border:1px solid var(--border);border-radius:var(--radius-md);">
    <div style="font-size:2.5rem;margin-bottom:1rem;">üìù</div>
    <h3 style="color:var(--text-muted);font-size:1.1rem;">No assessments yet</h3>
    <p style="color:var(--text-faint);margin-top:0.5rem;font-size:0.875rem;">Record one below to get started</p>
</div>
{% endif %}

<div class="section-panel">
    <div class="panel-title">‚ûï Record New Assessment</div>
    <form method="POST" action="/assessment/add">
        <div class="form-grid">
            <div class="form-group">
                <label>Student ID *</label>
                <input type="text" name="student_id" required placeholder="e.g. CD001">
            </div>
            <div class="form-group">
                <label>Subject *</label>
                <select name="subject" required>
                    <option value="">Select Subject</option>
                    {% for subject in subjects %}
                    <option value="{{ subject }}">{{ subject }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="form-group">
                <label>Assessment Type *</label>
                <select name="assessment_type" required>
                    <option value="">Select Type</option>
                    <option>Weekly Test</option>
                    <option>Monthly Test</option>
                    <option>Trial Exam</option>
                    <option>Final Exam</option>
                    <option>Assignment</option>
                    <option>Class Work</option>
                </select>
            </div>
            <div class="form-group">
                <label>Score *</label>
                <input type="number" name="score" required min="0" step="0.5" placeholder="75">
            </div>
            <div class="form-group">
                <label>Max Score</label>
                <input type="number" name="max_score" value="100" min="1" step="0.5">
            </div>
            <div class="form-group">
                <label>Date</label>
                <input type="date" name="date" value="{{ today }}">
            </div>
        </div>
        <div class="form-group" style="margin-top:0.75rem;">
            <label>Notes (optional)</label>
            <input type="text" name="notes" placeholder="Any notes about this assessment">
        </div>
        <button type="submit" class="btn-gold" style="margin-top:1rem;width:100%;justify-content:center;padding:0.85rem;">
            ‚úÖ Record Assessment
        </button>
    </form>
</div>
{% endblock %}
