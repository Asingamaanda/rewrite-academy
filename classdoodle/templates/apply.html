<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Apply — Rewrite Academy</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'"
        href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900&family=Inter:wght@300;400;500;600;700&display=swap">
  <noscript><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,700;0,900&family=Inter:wght@300;400;500;600;700&display=swap"></noscript>
  <style>
    *,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
    :root{
      --bg:#06080f;--surface:#0c0f1e;--border:rgba(34,211,238,.12);
      --accent:#22d3ee;--accent-dark:#0891b2;--fg:#f1f5f9;--fg-muted:#94a3b8;
      --green:#4ade80;--red:#f87171;--radius:12px;
    }
    html{scroll-behavior:smooth}
    body{font-family:'Inter',system-ui,sans-serif;background:var(--bg);color:var(--fg);min-height:100vh}

    /* NAV */
    nav{
      display:flex;align-items:center;justify-content:space-between;
      padding:18px 40px;border-bottom:1px solid var(--border);
      background:rgba(6,8,15,.9);backdrop-filter:blur(12px);
      position:sticky;top:0;z-index:50;
    }
    .nav-logo{font-family:'Playfair Display',serif;font-size:1.2rem;font-weight:700;
               color:var(--fg);text-decoration:none}
    .nav-logo span{color:var(--accent)}
    .btn-back{padding:7px 18px;border-radius:99px;border:1px solid var(--border);
               color:var(--fg-muted);font-size:.82rem;text-decoration:none;
               transition:border-color .2s,color .2s}
    .btn-back:hover{border-color:var(--accent);color:var(--fg)}

    /* LAYOUT */
    .page{max-width:720px;margin:0 auto;padding:56px 24px 80px}
    .page-label{font-size:.72rem;text-transform:uppercase;letter-spacing:.12em;color:var(--accent);margin-bottom:8px}
    .page-title{font-family:'Playfair Display',serif;font-size:clamp(1.8rem,4vw,2.4rem);
                font-weight:900;color:var(--fg);margin-bottom:10px}
    .page-sub{font-size:.95rem;color:var(--fg-muted);margin-bottom:36px;line-height:1.65}

    /* FLASH */
    .flash{padding:14px 18px;border-radius:var(--radius);margin-bottom:24px;font-size:.88rem}
    .flash.success{background:rgba(74,222,128,.1);border:1px solid rgba(74,222,128,.3);color:var(--green)}
    .flash.error{background:rgba(248,113,113,.1);border:1px solid rgba(248,113,113,.3);color:var(--red)}

    /* FORM */
    .form-card{background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:32px}
    .section-divider{font-size:.7rem;text-transform:uppercase;letter-spacing:.12em;color:var(--accent);
                     margin:28px 0 18px;padding-bottom:8px;border-bottom:1px solid var(--border)}
    .form-row{display:grid;gap:16px;margin-bottom:16px}
    .form-row.two{grid-template-columns:1fr 1fr}
    @media(max-width:560px){.form-row.two{grid-template-columns:1fr}}
    .form-group{display:flex;flex-direction:column;gap:6px}
    label{font-size:.78rem;font-weight:600;color:var(--fg-muted);text-transform:uppercase;letter-spacing:.07em}
    label .req{color:var(--accent)}
    input[type=text],input[type=email],input[type=tel],select,textarea{
      background:#111527;border:1px solid var(--border);border-radius:8px;
      color:var(--fg);font-family:'Inter',sans-serif;font-size:.88rem;
      padding:10px 14px;width:100%;transition:border-color .2s,box-shadow .2s;
      outline:none;
    }
    input:focus,select:focus,textarea:focus{
      border-color:var(--accent);box-shadow:0 0 0 3px rgba(34,211,238,.12)
    }
    select option{background:#111527;color:var(--fg)}
    textarea{resize:vertical;min-height:90px}

    /* SUBJECTS */
    .subjects-grid{
      display:grid;grid-template-columns:repeat(auto-fill,minmax(160px,1fr));gap:10px;margin-top:4px
    }
    .subject-check{
      display:flex;align-items:center;gap:8px;
      background:#111527;border:1px solid var(--border);border-radius:8px;
      padding:10px 12px;cursor:pointer;transition:border-color .2s,background .2s;
      font-size:.83rem;color:var(--fg-muted);
    }
    .subject-check input[type=checkbox]{
      width:16px;height:16px;accent-color:var(--accent);cursor:pointer;flex-shrink:0
    }
    .subject-check:has(input:checked){
      border-color:rgba(34,211,238,.4);background:rgba(34,211,238,.07);color:var(--fg)
    }

    /* SUBMIT */
    .btn-submit{
      width:100%;padding:14px;border-radius:10px;border:none;cursor:pointer;
      background:var(--accent);color:#06080f;font-size:1rem;font-weight:800;
      letter-spacing:.02em;margin-top:24px;
      box-shadow:0 0 32px rgba(34,211,238,.25);transition:box-shadow .2s,transform .15s
    }
    .btn-submit:hover{box-shadow:0 0 48px rgba(34,211,238,.4);transform:translateY(-2px)}
    .btn-submit:disabled{opacity:.6;cursor:not-allowed;transform:none}

    /* SUCCESS STATE */
    .success-box{
      text-align:center;padding:56px 32px;
      background:var(--surface);border:1px solid rgba(74,222,128,.2);border-radius:14px
    }
    .success-icon{font-size:3rem;margin-bottom:16px}
    .success-box h2{font-family:'Playfair Display',serif;font-size:1.8rem;font-weight:900;
                     color:var(--fg);margin-bottom:12px}
    .success-box p{color:var(--fg-muted);font-size:.95rem;line-height:1.7;max-width:400px;margin:0 auto 24px}
    .btn-home{display:inline-block;padding:11px 28px;border-radius:99px;
               background:var(--accent);color:#06080f;font-weight:700;font-size:.88rem;text-decoration:none}
  </style>
</head>
<body>

<nav>
  <a href="/" class="nav-logo">Rewrite<span>Academy</span></a>
  <a href="/" class="btn-back">← Back</a>
</nav>

<div class="page">

  {% if submitted %}
  <!-- SUCCESS STATE -->
  <div class="success-box">
    <div class="success-icon">✅</div>
    <h2>Application Received!</h2>
    <p>
      Thank you, <strong style="color:var(--fg)">{{ app_name }}</strong>. Your application has been saved
      and the teacher has been notified. Expect a call or message within 24 hours.
    </p>
    <a href="/" class="btn-home">Back to Home</a>
  </div>

  {% else %}
  <!-- FORM -->
  <div class="page-label">Enrolment Form</div>
  <h1 class="page-title">Apply to Rewrite Academy</h1>
  <p class="page-sub">
    Fill in the form below and your details will be sent directly to the teacher.
    You'll be contacted to confirm your enrolment and sort out payment.
  </p>

  {% with messages = get_flashed_messages(with_categories=true) %}
    {% for cat, msg in messages %}
      <div class="flash {{ cat }}">{{ msg }}</div>
    {% endfor %}
  {% endwith %}

  <form class="form-card" method="POST" action="/apply" id="applyForm">
    <!-- STUDENT -->
    <div class="section-divider">Student Details</div>
    <div class="form-row two">
      <div class="form-group">
        <label>Full Name <span class="req">*</span></label>
        <input type="text" name="full_name" placeholder="e.g. Thabo Nkosi" required>
      </div>
      <div class="form-group">
        <label>Phone Number <span class="req">*</span></label>
        <input type="tel" name="phone" placeholder="e.g. 071 234 5678" required>
      </div>
    </div>
    <div class="form-row">
      <div class="form-group">
        <label>Email Address <span style="color:var(--fg-muted);text-transform:none;letter-spacing:0">(optional)</span></label>
        <input type="email" name="email" placeholder="e.g. thabo@gmail.com">
      </div>
    </div>

    <!-- PARENT -->
    <div class="section-divider">Parent / Guardian</div>
    <div class="form-row two">
      <div class="form-group">
        <label>Parent Name</label>
        <input type="text" name="parent_name" placeholder="e.g. Nomsa Nkosi">
      </div>
      <div class="form-group">
        <label>Parent Phone</label>
        <input type="tel" name="parent_phone" placeholder="e.g. 082 987 6543">
      </div>
    </div>

    <!-- ACADEMIC -->
    <div class="section-divider">Academic Information</div>
    <div class="form-row two">
      <div class="form-group">
        <label>Previous School</label>
        <input type="text" name="previous_school" placeholder="e.g. Vuwani High School">
      </div>
      <div class="form-group">
        <label>Year You Failed / Wrote Matric <span class="req">*</span></label>
        <select name="year_failed" required>
          <option value="" disabled selected>Select year</option>
          <option>2025</option>
          <option>2024</option>
          <option>2023</option>
          <option>2022</option>
          <option>2021</option>
          <option>2020 or earlier</option>
        </select>
      </div>
    </div>

    <!-- SUBJECTS -->
    <div class="section-divider">Subjects to Rewrite <span class="req">*</span></div>
    <div class="subjects-grid" id="subjectsGrid">
      {% set all_subjects = [
        'Mathematics','Mathematical Literacy','Physical Sciences','Life Sciences',
        'Geography','History','English Home Language','English First Additional Language',
        'Afrikaans','Accounting','Business Studies','Economics'
      ] %}
      {% for subj in all_subjects %}
      <label class="subject-check">
        <input type="checkbox" name="subjects" value="{{ subj }}">
        {{ subj }}
      </label>
      {% endfor %}
    </div>
    <p id="subjectError" style="color:var(--red);font-size:.78rem;margin-top:8px;display:none">
      Please select at least one subject.
    </p>

    <!-- MESSAGE -->
    <div class="section-divider">Anything Else?</div>
    <div class="form-group">
      <label>Message to the Teacher <span style="color:var(--fg-muted);text-transform:none;letter-spacing:0">(optional)</span></label>
      <textarea name="message" placeholder="e.g. I failed Math with 42% and need extra help with functions and trigonometry..."></textarea>
    </div>

    <button type="submit" class="btn-submit" id="submitBtn">
      Submit Application →
    </button>

    <p style="text-align:center;font-size:.75rem;color:var(--fg-muted);margin-top:14px;">
      Your details are sent directly and securely to the teacher. No spam, ever.
    </p>
  </form>
  {% endif %}

</div>

<script>
  document.getElementById('applyForm')?.addEventListener('submit', function(e) {
    const checked = document.querySelectorAll('input[name="subjects"]:checked')
    if (checked.length === 0) {
      e.preventDefault()
      document.getElementById('subjectError').style.display = 'block'
      document.getElementById('subjectsGrid').scrollIntoView({behavior:'smooth',block:'center'})
      return
    }
    document.getElementById('subjectError').style.display = 'none'
    const btn = document.getElementById('submitBtn')
    btn.disabled = true
    btn.textContent = 'Submitting…'
  })
</script>
</body>
</html>
